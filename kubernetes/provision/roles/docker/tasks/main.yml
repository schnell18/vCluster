---
# tasks file for docker

- name: Add an apt signing key for Docker
  apt_key:
    data: "{{ lookup('file', 'docker-apt-key.asc') }}"
    state: present

- name: Add docker stable apt repository
  apt_repository:
    repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable
    state: present
    filename: docker

- name: Install docker and its dependecies
  apt:
    name: "{{ packages }}"
    state: present
    update_cache: yes
  vars:
    packages:
    - docker-ce
    - docker-ce-cli
    - containerd.io
  notify:
    - Restart docker

- name: Add devel user to docker group
  user:
    name: devel
    group: docker

- name: Make sure docker service config directory exists
  file:
    path: /etc/systemd/system/docker.service.d
    state: directory
- name: Configure docker pull proxy
  copy:
    content: "{{ lookup('template', 'socks5-proxy.conf') }}"
    mode: 0755
    dest: /etc/systemd/system/docker.service.d/socks5-proxy.conf
  when: enable_docker_socks5_proxy == True
  notify:
    - Restart docker

